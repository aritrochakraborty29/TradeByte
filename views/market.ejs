<section
  class="text-gray-700 body-font md:ml-56 lg:ml-64 md:mx-auto md:pr-14 w-screen"
>
  <div class="max-w-6xl mx-auto p-2 md:p-8">
    <div class="my-4 md:flex mx-2 md:items-center md:justify-center">
      <div class="md:w-2/3">
        <h2
          class="text-gray-700 lg:text-6xl text-5xl font-semibold leading-none tracking-wider px-5"
        >
          Popular Stocks
        </h2>
      </div>

      <!-- search box -->
      <div class="md:w-1/3">
        <div>
          <%- include('./partials/_search') %>

          <div class="relative w-full result hidden">
            <ul
              id="search-result"
              class="pt-2 -mt-2 bg-gray-300 rounded-full rounded-t-none absolute top-0 left-0 w-full"
            ></ul>
          </div>

          <!-- end of search box -->
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  var prev = document
    .getElementById("prev")
    .addEventListener("click", prevPage);
  var next = document
    .getElementById("next")
    .addEventListener("click", nextPage);
  function prevPage() {
    var url = window.location.href;
    var pageNo = url.slice(url.length - 1, url.length);
    var pageUrl = url.slice(0, url.length - 1);
    if (pageNo == "t") {
    } else if (pageNo == "/") {
    } else {
      window.location.href = pageUrl + (parseInt(pageNo) - 1);
    }
  }
  function nextPage() {
    if (window.location.pathname !== "/market/59") {
      var url = window.location.href;
      var pageNo = url.slice(url.length - 1, url.length) || 0;
      var pageUrl = url.slice(0, url.length - 1);
      if (pageNo == "t") {
        window.location.href = window.location.href + "/2";
      } else if (pageNo == "/") {
        window.location.href = window.location.href + "2";
      } else {
        window.location.href = pageUrl + (parseInt(pageNo) + 1);
      }
    }
  }
</script>

<!-- script for search bar -->

<script>
    const inputField = document.getElementById('searchbar')
    const inputResult = document.getElementById('search-result')
    const result = document.querySelector('.result')

  document.addEventListener('click', (e)=>{
    if( document.activeElement === inputField) {
      result.classList.remove('hidden')
    } else if(document.activeElement !== inputField){
      result.classList.add('hidden')
    }
  })

  inputField.addEventListener('input', (event) => {
      inputResult.classList.add('bg-white')
      console.log(event.target.value)
      const value = event.target.value
      //sample data
      const dataset = <%- JSON.stringify(totalData) %>;

      // when symbol matches
      let data = dataset.filter(function (el) {
          return el.Symbol.includes(value.toUpperCase())
      })

      // when no symbol matches

      if (data.length === 0) {

          let data1 = dataset.filter(function (el) {
              return (el["Company Name"].toLowerCase().includes(value.toLowerCase()))
          })
          data = data1;
      }

      let list = "";
      if (value === "") {
          list = "";
          data = [];
      }
      let n = data.length
      for (i = 0; i <= (n - 1); i++) {
          let item = data[i];
          list += `
          <a href='/view/${item.Symbol}'>
          <li class="bg-white p-2 w-full ${(i%2===0) ? 'bg-gray-300' : 'bg-gray-100'}">${item.Symbol}</li>
          </a>`
      }
      document.getElementById('search-result').innerHTML = list;
      console.log(data)
  })
</script>
